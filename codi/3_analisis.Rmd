---
title: 'Pharmacological Treatment at the start of TYPE 2 diabetes mellitus in Catalonia.[2007-2018]'
author: "Rai Puig & Jordi Real"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    css: logos_css/usr_styles.css
    fig_caption: yes
    toc: yes
    toc_float: yes
  pdf_document: default
  word_document:
    toc: yes
params:
   dir_dades_desti: "dades/mostra" # dades/mostra"  # dades 
   ANY: '2018'
   website: https://github.com/USR-DAPCAT/
---
&nbsp;
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"https://www.idiapjgol.org/images/logo.png\" style=\"float: right ;width: 130px;\"/>')
     $head.prepend('<img src=\"https://avatars2.githubusercontent.com/u/57066591?s=200&v=4\" style=\"margin-left:25% ;width: 80px;\"/>')
     $head.prepend('<img src=\"logos_css/logoDAP_Cat.png\" style=\"float: left:1;width: 185px;\"/>')
   });
</script>


<div class="watermark">DRAFT</div>

****

## 0. Status:

**Aggregation windows**

&check; dt_index1:[dt_diagnostics_AP_HOSP].DM2_incusion.[window.days=c(-Inf,0)] <br/>
&check; dt_index2:[dt_facturacio].DM2_incusion.[window.days=c(-Inf,0)] <br/>
&check; dt_index3:dt_variables/filter(cod=="GLICADA") %>% filter(val>=6.5) <br/>
&check; Dm2 debut: min.date(dt_index1,dt_index2,dt_index3) <br/>
&check; Problemes de SALUT:[dt_diagnostics_AP_HOSP] [window.days=c(-Inf,0)] <br/>
&check; Facturacio:[dtagr_facturat_2018_epiTempusDM2_1] [window.days=c(-Inf,0)] <br/>
&check; Facturacio.events:[dtagr_facturat_2018_epiTempusDM2_1] [window.days=c(0,Inf)] <br/>
&check; dt_variables=dt_analitiques+dt_cliniques [window.days=c(-365,0)] <br/>
&check; dt_tabaquisme [window.days=c(-Inf,0)] <br/>



**Latest Updates   October/ 2021** 

&check;   flat table construction+ Tables of first drug billed after diagnosis of DM2    <br/>


 
**Realized**

&check;   flat table construction+ Tables of first drug billed after diagnosis of DM2    <br/>


**Pending**

&check; Revision and debugging of errors.   <br/>

# Validation phase

## Preparation Phase


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, include=F,size="huge")

gc()
# libreries i funcions
library("dplyr")
library("lubridate")
library("compareGroups")


# Descarregar funcions github -
link_source<-paste0("https://github.com/jrealgatius/Stat_codis/blob/master/funcions_propies.R","?raw=T")
devtools::source_url(link_source)


conductor_codis<-here::here("CATALEG_PROYECTO_epitempus.xlsx")
conductor<-here::here("Conductor_PROYECTO_epitempus.xlsx")

```


```{r llegir, include = FALSE}
# Llegir plana
dt_plana<-readRDS(here::here(params$dir_dades_desti,"dt_plana2.rds")) %>% as_tibble()
```
## 1. Flow chart 
```{r Flow chart, include=T}



flow_chart1<-criteris_exclusio_diagrama(dt=dt_plana,
                                        taulavariables=conductor,
                                        criteris = "exc_pre",
                                        ordre="exc_ordre",
                                        grups=NA,
                                        etiquetes="descripcio2",
                                        sequencial = T,
                                        pob_lab=c("epiTempus DM2  ","epiTempus DM2 without exclusions"),
                                        colors=c("white","grey"),
                                        forma=c("ellipse","box"))

flow_chart1




#Apliquem les EXCLUSIONS!
dt_plana_exc<-criteris_exclusio(dt_plana,taulavariables=conductor,criteris="exc_pre")



#Apliquem que surtin els MISSINGS a les TAULES , a partir del CONDUCTOR!
dt_plana_exc<-dt_plana_exc%>%mutate_at(extreure.variables("missings",conductor,dt=dt_plana_exc),as.factor)

#Etquetem  NOMS! de les  VAR  a partir del Conductor!
dt_plana_exc<-etiquetar(dt_plana_exc,taulavariables=conductor,camp_descripcio="descripcio2")



#################################
# eps rectificat!: #[12.07.2021]#
#################################

#dt_temporal<-dt_plana_exc%>%select(idp,PAS_PAD2b,PAS.mean,PAD.mean)%>%group_by(PAS_PAD2b)%>%summarise(min(PAS.mean),max(PAS.mean),min(PAD.mean),max(PAD.mean))%>%ungroup()
#dt_temporal2<-dt_plana_exc%>%select(idp,PAS_PAD2b,PAS.mean,PAD.mean)
#dt_temporal3<-dt_plana_exc%>%select(idp,PAS_PAD1b,PAS.valor,PAD.valor)%>%group_by(PAS_PAD1b)%>%summarise(min(PAS.valor),max(PAS.valor),min(PAD.valor),max(PAD.valor))%>%ungroup()
#dt_temporal4<-dt_plana_exc%>%select(idp,PAS_PAD1b,PAS.valor,PAD.valor)



```

```{r formules, include=F}

#fem les formules per fer les Taules:

#
formu<- formula_table1 ("Taula01",y="",taulavariables=conductor,dt=dt_plana_exc)

formu1<-formula_table1("Taula00",y="First.event_Metformina",taulavariables=conductor,dt=dt_plana_exc)
formu2<-formula_table1("Taula00",y="First.event_pioglitazona",taulavariables=conductor,dt=dt_plana_exc)
formu3<-formula_table1("Taula00",y="First.event_Sulfonilureas",taulavariables=conductor,dt=dt_plana_exc)
formu4<-formula_table1("Taula00",y="First.event_Glinides",taulavariables=conductor,dt=dt_plana_exc)
formu5<-formula_table1("Taula00",y="First.event_ISGLT2",taulavariables=conductor,dt=dt_plana_exc)
formu6<-formula_table1("Taula00",y="First.event_IDPP4",taulavariables=conductor,dt=dt_plana_exc)
formu7<-formula_table1("Taula00",y="First.event_aGLP1",taulavariables=conductor,dt=dt_plana_exc)
formu8<-formula_table1("Taula00",y="First.event_Insul",taulavariables=conductor,dt=dt_plana_exc)



```
## 2. Descriptive and exploratory general.
```{r resultats1, include=T}
#

#render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.missing=NULL,render.categorical="FREQ (PCTnoNA%)")
#table1(~ age + sex + wt | treat, data=dat, topclass="Rtable1-zebra")

#i) GENERAL
table1::table1(formu,
               data = dt_plana_exc,caption="General descriptive analysis",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

```
## 3. Descriptive and exploratory general.First drug billed after diagnosis of DM2

```{r resultats2, include=F}

#age5.cat
#DG.ARTPER.AVC.CI: (DG.ARTPER+DG.AVC+DG.CI)  
#DG.IC    
#CKDEPI.valor_CAT4              
#CKDEPI.valor_CAT5              
#IMC.valor_cat3
#GLICADA_CAT3

formu1b<-formula_table1("Farmacs_ad","age5.cat", taulavariables = conductor)
formu2b<-formula_table1("Farmacs_ad","DG.ARTPER.AVC.CI", taulavariables = conductor)
formu3b<-formula_table1("Farmacs_ad","DG.IC", taulavariables = conductor)
formu4b<-formula_table1("Farmacs_ad","CKDEPI.valor_CAT4", taulavariables = conductor)
formu5b<-formula_table1("Farmacs_ad","CKDEPI.valor_CAT5", taulavariables = conductor)
formu6b<-formula_table1("Farmacs_ad","IMC.valor_cat3", taulavariables = conductor)
formu7b<-formula_table1("Farmacs_ad","GLICADA_CAT3", taulavariables = conductor)



table1::table1(formu1b,
               data = dt_plana_exc,caption="First drug billed after diagnosis DM2 by age",topclass="Rtable1-zebra")

table1::table1(formu2b,
               data = dt_plana_exc,caption="First drug billed after diagnosis DM2 by background heart attack, stroke or ArtPer",topclass="Rtable1-zebra")


table1::table1(formu3b,
               data = dt_plana_exc,caption="First drug billed after diagnosis DM2 by Heart failure",topclass="Rtable1-zebra")


table1::table1(formu4b,
               data = dt_plana_exc,caption="First drug billed after diagnosis DM2 by FG<60(CKD-epi)",topclass="Rtable1-zebra")


table1::table1(formu5b,
               data = dt_plana_exc,caption="First drug billed after diagnosis DM2 by FG<30(CKD-epi)",topclass="Rtable1-zebra")


table1::table1(formu6b,
               data = dt_plana_exc,caption="First drug billed after diagnosis DM2 by BMI>35  ",topclass="Rtable1-zebra")


table1::table1(formu7b,
               data = dt_plana_exc,caption="First drug billed after diagnosis DM2 by HbA1c",topclass="Rtable1-zebra")
```


```{r resultats3, include=F}

#ii)            Metformina
table1::table1(formu1,
               data = dt_plana_exc,caption="Descriptive analysis General.First drug Metformin",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.missing=NULL,render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")


#iii)           Pioglitazona
table1::table1(formu2,
               data = dt_plana_exc,caption="Descriptive analysis General.First drug Pioglitazone",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.missing=NULL,render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")


#iv)            Sulfonilureas
table1::table1(formu3,
               data = dt_plana_exc,caption="Descriptive analysis General.First drug Sulfonylureas",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.missing=NULL,render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")


#v)             Glinides
table1::table1(formu4,
               data = dt_plana_exc,caption="Descriptive analysis General.First drug Glinides",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.missing=NULL,render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")


#vi)            ISGLT2
table1::table1(formu5,
               data = dt_plana_exc,caption="Descriptive analysis General.First drug ISGLT2",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.missing=NULL,render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")


#vii)           IDPP4
table1::table1(formu6,
               data = dt_plana_exc,caption="Descriptive analysis General.First drug IDPP4",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.missing=NULL,render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")


#viii)          aGLP1
table1::table1(formu7,
               data = dt_plana_exc,caption="Descriptive analysis General.First drug aGLP1",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.missing=NULL,render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")


#ix)            Insul
table1::table1(formu8,
               data = dt_plana_exc,caption="Descriptive analysis General.First drug Insulin",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.missing=NULL,render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")






```


```{r resultats4, include=T}



formu1c<-formula.text("Farmacs_ad","age5.cat", taulavariables = conductor)
formu2c<-formula.text("Farmacs_ad","DG.ARTPER.AVC.CI", taulavariables = conductor)
formu3c<-formula.text("Farmacs_ad","DG.IC", taulavariables = conductor)
formu4c<-formula.text("Farmacs_ad","CKDEPI.valor_CAT4", taulavariables = conductor)
formu5c<-formula.text("Farmacs_ad","CKDEPI.valor_CAT5", taulavariables = conductor)
formu6c<-formula.text("Farmacs_ad","IMC.valor_cat3", taulavariables = conductor)
formu7c<-formula.text("Farmacs_ad","GLICADA_CAT3", taulavariables = conductor)



descrTable(formu1c,data=dt_plana_exc,show.p.overall = F,hide = "No") %>% 
  export2md(caption="First drug billed after diagnosis DM2 by age")

descrTable(formu2c,data=dt_plana_exc,show.p.overall = F,hide = "No") %>% 
  export2md(caption="First drug billed after diagnosis DM2 by background heart attack, stroke or ArtPer")

descrTable(formu3c,data=dt_plana_exc,show.p.overall = F,hide = "No") %>% 
  export2md(caption="First drug billed after diagnosis DM2 by Heart failure")

descrTable(formu4c,data=dt_plana_exc,show.p.overall = F,hide = "No") %>% 
  export2md(caption="First drug billed after diagnosis DM2 by FG<60(CKD-epi)")

descrTable(formu5c,data=dt_plana_exc,show.p.overall = F,hide = "No") %>% 
  export2md(caption="First drug billed after diagnosis DM2 by FG<30(CKD-epi)")

descrTable(formu6c,data=dt_plana_exc,show.p.overall = F,hide = "No") %>% 
  export2md(caption="First drug billed after diagnosis DM2 by BMI>35  ")

descrTable(formu7c,data=dt_plana_exc,show.p.overall = F,hide = "No") %>% 
  export2md(caption="First drug billed after diagnosis DM2 by HbA1c")


```

## 4. HbA1c value before 1st billing and Global.
```{r resultats5, include=T}

#table(dt_plana_exc$First.event_Metformina)
#table(dt_plana_exc$FF.EVENT.Metformina)

#0b)
hist(dt_plana_exc$GLICADA.valor,
     main="Distribution of glycated values(HbA1c),without exclusions",
     xlab="HbA1c value nearest one year ago for each patient",
     ylab="Frequency",
     col="black",
     freq=T,
     xlim=c(3,20) ,
     ylim=c(0,250),
     breaks = 1000,
         )
print(paste("MIN.Glycated values(HbA1c) :",min(dt_plana_exc$GLICADA.valor, na.rm=TRUE)))
print(paste("MAX.Glycated values(HbA1c) :",max(dt_plana_exc$GLICADA.valor, na.rm=TRUE)))




#formu<-formula.text("Farmacs_ad","GLICADA.val.first", taulavariables = conductor)
#formu
#
#descrTable(formu,data=dt_plana_exc,show.p.overall = F,hide = "No") %>% 
#  export2md(caption="Descriptive analysis")






formu<-formula_table1("Glicada_farmac","",taulavariables = conductor)
#i) GENERAL
table1::table1(formu ,
               data = dt_plana_exc,caption="General descriptive analysis.Drugs.",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")





#i) GENERAL
#table1::table1(~GLICADA.val.first | First.event_Metformina  ,
#               data = dt_plana_exc,caption="General descriptive analysis.Drug:Metformina",
#               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ #(PCTnoNA%)",topclass="Rtable1-zebra")




##ii) GENERAL
#table1::table1(~GLICADA.val.first | First.event_pioglitazona,
#               data = dt_plana_exc,caption="General descriptive analysis.Drug:Pioglitazona",
#               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#iii) GENERAL
#table1::table1(~GLICADA.val.first |First.event_Sulfonilureas,
#               data = dt_plana_exc,caption="General descriptive analysis.Drug:Sulfonilureas",
#               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#iv) GENERAL
#table1::table1(~GLICADA.val.first | First.event_Glinides,
#               data = dt_plana_exc,caption="General descriptive analysis.Drug:Glinide",
#               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#v) GENERAL
#table1::table1(~GLICADA.val.first | First.event_ISGLT2,
#               data = dt_plana_exc,caption="General descriptive analysis.Drug:ISGLT2",
#               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#vi) GENERAL
#table1::table1(~GLICADA.val.first | First.event_IDPP4,
#               data = dt_plana_exc,caption="General descriptive analysis.Drug:IDPP4",
#               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#vii) GENERAL
#table1::table1(~GLICADA.val.first | First.event_aGLP1,
#               data = dt_plana_exc,caption="General descriptive analysis.Drug:aGLP1",
#               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#viii) GENERAL
#table1::table1(~GLICADA.val.first | First.event_Insul,
#               data = dt_plana_exc,caption="General descriptive analysis.Drug:Insulin",
#               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")
```
## 5. Months between the onset of DM2 and the first billing.


```{r resultats6, include=T}

formu<-formula_table1("Temps_farmac","",taulavariables = conductor)


#i) GENERAL
table1::table1(formu ,
               data = dt_plana_exc,caption="General descriptive analysis.Times(months) between Index date and First drug,without exclusions.Drug:Metformina",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")




```


```{r resultats7, include=T,eval=FALSE}

# names(dt_plana_exc) %>% write.csv2("vars.csv")

#i) GENERAL
table1::table1(~First.event_Metformina_Temps_Index ,
               data = dt_plana_exc,caption="General descriptive analysis.Times(months) between Index date and First drug,without exclusions.Drug:Metformina",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#ii) GENERAL
table1::table1(~First.event_pioglitazona_Temps_Index ,
               data = dt_plana_exc,caption="General descriptive analysis.Times(months) between Index date and First drug,without exclusions.Drug:Pioglitazona",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#iii) GENERAL
table1::table1(~First.event_Sulfonilureas_Temps_Index ,
               data = dt_plana_exc,caption="General descriptive analysis.Times(months) between Index date and First drug,without exclusions.Drug:Sulfonilureas",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#iv) GENERAL
table1::table1(~First.event_Glinides_Temps_Index,
               data = dt_plana_exc,caption="General descriptive analysis.Times(months) between Index date and First drug,without exclusions.Drug:Glinide",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#v) GENERAL
table1::table1(~First.event_ISGLT2_Temps_Index,
               data = dt_plana_exc,caption="General descriptive analysis.Times(months) between Index date and First drug,without exclusions.Drug:ISGLT2",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#vi) GENERAL
table1::table1(~First.event_IDPP4_Temps_Index ,
               data = dt_plana_exc,caption="General descriptive analysis.Times(months) between Index date and First drug,without exclusions.Drug:IDPP4",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#vii) GENERAL
table1::table1(~First.event_aGLP1_Temps_Index ,
               data = dt_plana_exc,caption="General descriptive analysis.Times(months) between Index date and First drug,without exclusions.Drug:aGLP1",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")

#viii) GENERAL
table1::table1(~First.event_Insul_Temps_Index ,
               data = dt_plana_exc,caption="General descriptive analysis.Times(months) between Index date and First drug,without exclusions.Drug:Insulin",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-zebra")






```
## 6. Graphics of  Months between the onset of DM2 and the first billing.
```{r resultats8, include=T}


#i)
hist(dt_plana_exc$First.event_Metformina_Temps_Index,
     main="Distribution of Times(months) between Index date and First drug,without exclusions",
     xlab="Drug:Metformin",
     ylab="Frequency",
     col="black",
     freq=T,
     xlim=c(0,100) ,
     ylim=c(0,250),
     breaks = 1000,
         )
print(paste("MIN.Metformin value :",min(dt_plana_exc$First.event_Metformina_Temps_Index, na.rm=TRUE)))
print(paste("MAX.Metformin value :",max(dt_plana_exc$First.event_Metformina_Temps_Index, na.rm=TRUE)))





#ii)

hist(dt_plana_exc$First.event_pioglitazona_Temps_Index,
     main="Distribution of Times(months) between Index date and First drug,without exclusions",
     xlab="Drug:Pioglitazone",
     ylab="Frequency",
     col="black",
     freq=T,
     xlim=c(0,50) ,
     ylim=c(0,10),
     breaks = 1000,
         )
print(paste("MIN.Pioglitazone value :",min(dt_plana_exc$First.event_pioglitazona_Temps_Index, na.rm=TRUE)))
print(paste("MAX.Pioglitazone value :",max(dt_plana_exc$First.event_pioglitazona_Temps_Index, na.rm=TRUE)))





#iii)
hist(dt_plana_exc$First.event_Sulfonilureas_Temps_Index,
    main="Distribution of Times(months) between Index date and First drug,without exclusions",
     xlab="Drug:Sulfonylureas",
     ylab="Frequency",
     col="black",
     freq=T,
     xlim=c(0,100) ,
     ylim=c(0,150),
     breaks = 1000,
         )
print(paste("MIN.Sulfonylureas value :",min(dt_plana_exc$First.event_Sulfonilureas_Temps_Index, na.rm=TRUE)))
print(paste("MAX.Sulfonylureas value :",max(dt_plana_exc$First.event_Sulfonilureas_Temps_Index, na.rm=TRUE)))





#iv)
hist(dt_plana_exc$First.event_Glinides_Temps_Index,
     main="Distribution of Times(months) between Index date and First drug,without exclusions",
     xlab="Drug:Glinides",
     ylab="Frequency",
     col="black",
     freq=T,
     xlim=c(0,100) ,
     ylim=c(0,30),
     breaks = 1000,
         )
print(paste("MIN.Glinides value :",min(dt_plana_exc$First.event_Glinides_Temps_Index, na.rm=TRUE)))
print(paste("MAX.Glinides value :",max(dt_plana_exc$First.event_Glinides_Temps_Index, na.rm=TRUE)))







#v)
hist(dt_plana_exc$First.event_ISGLT2_Temps_Index,
     main="Distribution of Times(months) between Index date and First drug,without exclusions",
     xlab="Drug:ISGLT2",
     ylab="Frequency",
     col="black",
     freq=T,
     xlim=c(0,100) ,
     ylim=c(0,15),
   breaks = 1000,
         )
print(paste("MIN.ISGLT2 value :",min(dt_plana_exc$First.event_ISGLT2_Temps_Index, na.rm=TRUE)))
print(paste("MAX.ISGLT2 value :",max(dt_plana_exc$First.event_ISGLT2_Temps_Index, na.rm=TRUE)))





#vi)
hist(dt_plana_exc$First.event_IDPP4_Temps_Index,
     main="Distribution of Times(months) between Index date and First drug,without exclusions",
    xlab="Drug:IDPP4",
     ylab="Frequency",
     col="black",
     freq=T,
     xlim=c(0,100) ,
     ylim=c(0,100),
     breaks = 1000,
         )
print(paste("MIN.IDPP4 value :",min(dt_plana_exc$First.event_IDPP4_Temps_Index, na.rm=TRUE)))
print(paste("MAX.IDPP4 value :",max(dt_plana_exc$First.event_IDPP4_Temps_Index, na.rm=TRUE)))




#vii)
hist(dt_plana_exc$First.event_aGLP1_Temps_Index,
     main="Distribution of Times(months) between Index date and First drug,without exclusions",
     xlab="Drug:aGLP1",
     ylab="Frequency",
     col="black",
     freq=T,
     xlim=c(0,5) ,
     ylim=c(0,10),
     breaks = 1000,
         )
print(paste("MIN.aGLP1 value :",min(dt_plana_exc$First.event_aGLP1_Temps_Index, na.rm=TRUE)))
print(paste("MAX.aGLP1 value :",max(dt_plana_exc$First.event_aGLP1_Temps_Index, na.rm=TRUE)))


#viii)
hist(dt_plana_exc$First.event_Insul_Temps_Index,
     main="Distribution of Times(months) between Index date and First drug,without exclusions",
     xlab="Drug:Insulin",
     ylab="Frequency",
     col="black",
     freq=T,
     xlim=c(0,115) ,
     ylim=c(0,150),
     breaks = 1000,
         )
print(paste("MIN.Insulin value :",min(dt_plana_exc$First.event_Insul_Temps_Index, na.rm=TRUE)))
print(paste("MAX.Insulin value :",max(dt_plana_exc$First.event_Insul_Temps_Index, na.rm=TRUE)))






```
## 7. Association between the second drug and the first
```{r resultats9, include=T}





#GENERAL First Drug/ Second Drug.

table1::table1(~ Second.event_Sulfonilureas+
                 Second.event_Glinides+
                 Second.event_IDPP4+
                 Second.event_pioglitazona+
                 Second.event_ISGLT2+
                 Second.event_aGLP1+
                 Second.event_Insul
                 | First.event_Metformina ,data = dt_plana_exc%>%filter( First.event_Metformina=="Yes"),caption="General descriptive analysis.First.Drug:Metformin",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)", topclass="Rtable1-grid Rtable1-shade Rtable1-times")


table1::table1(~Second.event_Metformina+
                 Second.event_Glinides+
                 Second.event_IDPP4+
                 Second.event_pioglitazona+
                 Second.event_ISGLT2+
                 Second.event_aGLP1+
                 Second.event_Insul
                 | First.event_Sulfonilureas ,data = dt_plana_exc%>%filter( First.event_Sulfonilureas=="Yes"),caption="General descriptive analysis.First.Drug:Sulfonilureas",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)", topclass="Rtable1-grid Rtable1-shade Rtable1-times")


table1::table1(~Second.event_Metformina+
                 Second.event_Sulfonilureas+
                 Second.event_IDPP4+
                 Second.event_pioglitazona+
                 Second.event_ISGLT2+
                 Second.event_aGLP1+
                 Second.event_Insul
                 | First.event_Glinides ,data = dt_plana_exc%>%filter( First.event_Glinides=="Yes"),caption="General descriptive analysis.First.Drug:Glinides",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)", topclass="Rtable1-grid Rtable1-shade Rtable1-times")


table1::table1(~Second.event_Metformina+
                 Second.event_Sulfonilureas+
                 Second.event_Glinides+
                 Second.event_pioglitazona+
                 Second.event_ISGLT2+
                 Second.event_aGLP1+
                 Second.event_Insul
                 | First.event_IDPP4 ,data = dt_plana_exc%>%filter( First.event_IDPP4=="Yes"),caption="General descriptive analysis.First.Drug:IDPP4",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-grid Rtable1-shade Rtable1-times")





table1::table1(~Second.event_Metformina+
                 Second.event_Sulfonilureas+
                 Second.event_Glinides+
                 Second.event_IDPP4+
                 Second.event_ISGLT2+
                 Second.event_aGLP1+
                 Second.event_Insul
                 | First.event_pioglitazona ,data = dt_plana_exc%>%filter( First.event_pioglitazona=="Yes"),caption="General descriptive analysis.First.Drug:pioglitazona",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-grid Rtable1-shade Rtable1-times")

table1::table1(~Second.event_Metformina+
                 Second.event_Sulfonilureas+
                 Second.event_Glinides+
                 Second.event_IDPP4+
                 Second.event_pioglitazona+
                 Second.event_aGLP1+
                 Second.event_Insul
                 | First.event_ISGLT2 ,data = dt_plana_exc%>%filter(First.event_ISGLT2=="Yes"),caption="General descriptive analysis.First.Drug:ISGLT2",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-grid Rtable1-shade Rtable1-times")

table1::table1(~Second.event_Metformina+
                 Second.event_Sulfonilureas+
                 Second.event_Glinides+
                 Second.event_IDPP4+
                 Second.event_pioglitazona+
                 Second.event_ISGLT2+
                 Second.event_Insul
                 | First.event_aGLP1 ,data = dt_plana_exc%>%filter(First.event_aGLP1=="Yes"),caption="General descriptive analysis.First.Drug:aGLP1",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-grid Rtable1-shade Rtable1-times")


table1::table1(~Second.event_Metformina+
                 Second.event_Sulfonilureas+
                 Second.event_Glinides+
                 Second.event_IDPP4+
                 Second.event_pioglitazona+
                 Second.event_ISGLT2+
                 Second.event_aGLP1
                 | First.event_Insul ,data = dt_plana_exc%>%filter(First.event_Insul=="Yes"),caption="General descriptive analysis.First.Drug:Insulin",
               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"),render.categorical="FREQ (PCTnoNA%)",topclass="Rtable1-grid Rtable1-shade Rtable1-times")

```
## 8. [E R R O R S]
```{r resultats10, include=F}

# E R R O R S !!!

print("")
print("")
print("")


```
## 9. ANNEX: TYPE 2 diabetes codes
```{r codis_diabetes2, include=T}

readxl::read_excel(conductor_codis,col_types = "text")%>%select(cod,AGR1,Descripcio)%>% filter(AGR1=="DM2_incusion")%>%select(cod,Descripcio)%>% knitr::kable(caption="Códigos ICD10  y  Fármacos Diabetes TIPO 2")


```
## 10. Save the flat table
```{r salvar}
saveRDS(dt_plana_exc, file=here::here(params$dir_dades_desti,"dt_plana_exc.rds"))

```
&nbsp;
<hr />
<p style="text-align: center;">A work by $Jordi Real$ $Rai Puig$ </a></p>
<p style="text-align: center;">$Llepali System$ </a></p>
<p style="text-align: center;"><span style="color: #808080;"><em><https://github.com/USR-DAPCAT/></em></span></p>



